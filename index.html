<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2>Student API</h2>

    <div class="card mt-3">
        <div class="card-body">
            <h4>Register</h4>
            <form id="registerForm">
                <input type="email" id="registerEmail" placeholder="Email" class="form-control mb-2" required>
                <input type="password" id="registerPassword" placeholder="Password" class="form-control mb-2" required>
                <button type="submit" class="btn btn-primary">Register</button>
            </form>
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-body">
            <h4>Login</h4>
            <form id="loginForm">
                <input type="email" id="loginEmail" placeholder="Email" class="form-control mb-2" required>
                <input type="password" id="loginPassword" placeholder="Password" class="form-control mb-2" required>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-body">
            <h4>Create student</h4>
            <form id="createstudentForm">
                <input type="text" id="studentName" placeholder="student Name" class="form-control mb-2" required>
                <textarea id="studentEmail" placeholder="student Email" class="form-control mb-2" required></textarea>
                <button type="submit" class="btn btn-success">Create student</button>
            </form>
        </div>
    </div>

    <div class="mt-3">
        <button id="viewstudentsBtn" class="btn btn-info">View All students</button>
        <div id="studentsList" class="mt-3"></div>
    </div>
</div>

<script>
    let token = null;

 
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;

        fetch('http://localhost:5000/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email: email, password: password })
        })
        .then(response => response.json())
        .then(data => alert(data.message))
        .catch(error => console.error('Error:', error));
    });

   
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        fetch('http://localhost:5000/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email: email, password: password })
        })
        .then(response => response.json())
        .then(data => {
            token = data.token;
            alert('Logged in successfully');
        })
        .catch(error => console.error('Error:', error));
    });


    document.getElementById('createstudentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('studentName').value;
        const email = document.getElementById('studentEmail').value;

        if (!token) {
            alert('Please log in first.');
            return;
        }

        fetch('http://localhost:5000/students', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'access-token': token
            },
            body: JSON.stringify({ name: name, email: email })
        })
        .then(response => response.json())
        .then(data => alert(data.message))
        .catch(error => console.error('Error:', error));
    });


    document.getElementById('viewstudentsBtn').addEventListener('click', function() {
        fetch('http://localhost:5000/students')
        .then(response => response.json())
        .then(data => {
            let studentsHtml =`
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                    </tr>
                </thead>
                <tbody>
        `;
            data.forEach(student => {
                studentsHtml +=  `
                <tr>
                    <td>${student.name}</td>
                    <td>${student.email}</td>
                </tr>
            `;
            });
            studentsHtml += `
                </tbody>
            </table>
        `;
            document.getElementById('studentsList').innerHTML = studentsHtml;
        })
        .catch(error => console.error('Error:', error));
    });
</script>

</body>
</html>
